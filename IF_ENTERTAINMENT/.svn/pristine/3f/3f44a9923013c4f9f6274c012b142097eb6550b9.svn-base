<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>

<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/css1/font-awesome.min.css">
<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/css1/themify-icons.css">
<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/css1/line-icons.css">
<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/css1/bootstrap.min.css">
<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/css1/animate.min.css">
<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/css1/perfect-scrollbar.min.css">
<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/css1/jquery.datepicker.min.css">

<script src="${pageContext.request.contextPath }/resources/js1/jquery.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/bootstrap.min.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/perfect-scrollbar.jquery.min.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/chart.min.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/echart.min.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/jquery.sparkline.min.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/custom2.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/flatweather.min.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/html5lightbox.js"></script> 
<script src="${pageContext.request.contextPath }/resources/js1/custom.js"></script>

<style>
/* 셀렉트 박스 스타일 */
select {
	font-family: inherit;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-color: #f4f8ff;
    border: 1px solid #eaeaea;
    padding: 8px 12px;
    border-radius: 5px;
    width: 100%;
    font-size: 14px;
    color: #333333;
    cursor: pointer;
    outline: none;
    height: 50px;
    position: relative;
}

/* 셀렉트 박스 드롭다운 스타일 */
select option {
	font-family: inherit;
    background-color: #f4f8ff;
    color: #333333;
}

#upload-span{
	display: block;	
}

/* 데이트피커 */
.datepicker {
    font-family: inherit;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-color: #f4f8ff;
    border: 1px solid #eaeaea;
    padding: 12px; /* 상하좌우 패딩을 더 크게 설정 */
    border-radius: 5px;
    width: calc(50% - 6px); /* 폭을 50%로 설정하고 간격은 여유 공간으로 조절 */
    font-size: 14px;
    color: #333333;
    cursor: pointer;
    outline: none;
    height: 50px;
    position: relative;
}

#rows div, #surveyQuestion div {
	margin-bottom: 20px;
}

.dateForm {
	display: flex;
	flex-direction: column;
}

#surveyFormTitle {
	margin-bottom: 55px;
}
#surveyFormDisplay{
	margin-top: 50px;
}

#bigTitle {
	margin-bottom: 50px; 
	font-weight: bolder;
}

#buttonz {
    position: relative;
    bottom: -20px;
    margin-top: 70px;
    float: left;
    text-align: right;
    width: 100%;
}

#upload-span {
	font-weight: bolder;
	font-size: 13px;
}

label {
	font-weight: bolder;
	font-size: 15px;
}

/* 동적 설문지 추가 관련 css */

#sfDisplay {
    margin-left: 15px;
    top: 1px;
    position: relative;
}

#sfTitle{
	width: 1155px;
}

#surveyQuestion {
	max-width: 1155px;
	background-color: salmon;
	border: 2px solid black;
 	height: auto;
	min-height: 200px; 
	padding: 20px;
}
.qna_btnbox {
	display: flex;
	justify-content: flex-end;
}

.fileContainer {
	border: 1px solid #eaeaea;
	height: 50px;
}
.fileContainer > span {
	position: relative;
    bottom: 0;
    height: 30px;
}

#vertical{
	margin: 0;
	padding: 5px;
	top: 0;
	bottom: 0;
}

.questions{
	padding: 15px;
	border: 1px solid white;
	color: black;
	font-size: larger;
	margin-top: 20px;
}

.questionNo{
	position: relative;
	left: 10px;
    top: 10px;
    width: 50px;
    font-size: initial;
    margin-right: 9px;
}

/* #addQuestionBtn {
	margin-top: 10px;
	position: relative;
	left: 1035px;
} */

.answer {
	display: flex;
}

.answerInput {
	height: 20px;
}

.answers {
	padding: 20px;
	padding-bottom: 0;
	padding-left: 38px;
	margin-bottom: 0;
	border: 1px solid white;
	height: auto;
	/* min-height: 100px; */
}

.answerNo {
	font-size: x-large;
}

.answerBtn-box {
	position: relative;
    left: 90%;
    bottom: -15px;
}

.types{
	display: flex;
}

.delQeustion {
	cursor: pointer;
	z-index: 1;
}
</style>

<div class="gap no-gap">
	<div class="inner-bg">
		<div class="element-title" id="bigTitle">
			<h2>설문조사 등록</h2>
		</div>
		<div class="add-prod-from">
			<form action="#" method="post" id="surveyForm" enctype="multipart/form-data">
				<div class="row" id="rows">
					<div class="col-md-12" id="surveyFormTitle">
						<div style="padding: 0; margin: 0;">
							<label>설문 제목</label>
						</div>
						<input type="text" id="sfTitle" name="sfTitle">
					</div>
					<div class="col-md-12">
						<span id="upload-span" class="upload-image">썸네일</span> 
						<label class="fileContainer" style="width: 500px;"> 
							<span id="vertical">upload</span>
							<input type="file" id="sfFile" name="sfFile" />
						</label>
						<div id="sfFileImg"></div>
					</div>

					<div class="col-md-6 dateForm">
						<label>시작일</label> 
						<input type="date" class="datepicker startDate" id="sfRegdate" name="sfRegdate" style="width: 500px;"/>
					</div>

					<div class="col-md-6  dateForm" style="right: 129px;">
						<label>마감일</label> 
						<input type="date" class="datepicker endDate" id="sfEnddate" name="sfEnddate" style="width: 500px;" />
					</div>

					<div class="col-md-4" id="surveyFormDisplay">
						<label>팝업 등록 여부</label> 
						<input type="checkbox" class="check-box" id="sfDisplay" name="sfDisplay" value="Y">
					</div>
				</div>
			</form>
			<label>설문 내용</label>
			<div id="surveyQuestion">
				<div class="qna_btnbox">
					<a href="#" id="addQuestionBtn" class="btn-st bordr rd-30">질문추가</a>
				</div>
				<!-- 동적으로 질문 추가시작 -->
				<!-- 아코디언 시작 -->
				<div class="accordians-style">
					<div class="gap">
						<div class="toggle toggle-style3" id="toggle3">

							<div class="toggle-item brd-5 activate">
<!-- 								<div class="forDelete"> -->
									<h3 class="active">
										<i class="fa fa-leaf"></i><font style="font-size:x-large;">질문1</font>
										<i class="fa fa-close fa-2x delQuestion" data-idx="1" style="position:relative; top:-5px; left: 890px; background: none;"></i>
									</h3>
<!-- 								</div> -->
								<div class="content">
									<div class="questions">
										<div class="qna">
											<div class="qna-box" style="height: 50px; display: flex;">
												<label class="questionNo" style="width: 70px; font-size: larger;">질문</label>
												<input type="text" style="width: 850px;" name="sqTitle" />
											</div>
											<div class="types" style="margin-bottom: 5px;">
												<label class="questionNo" style="top: 4px; width: 70px; font-size: larger;">유형</label>
												<select  name="sqType" style="width: 300px; height: 50px;" class="selects">
													<option value="">유형을 선택해주세요</option>
													<option value="">체크박스(복수선택 가능)</option>
													<option value="">라디오(단일선텍)</option>
												</select>
											</div>
											<div class="answers">
												<div class="answer">
													<span class="answerNo">①</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>
												<div class="answer">
													<span class="answerNo">②</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>
												<div class="answer">
													<span class="answerNo">③</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>
												<div class="answer">
													<span class="answerNo">④</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>

											</div>
										</div>
										<div class="answerBtn-box">
											<a href="#" id="addAnswerBtn" class="btn-st bordr rd-30">보기추가</a>
										</div>
									</div>
								</div>
							</div>

							<div class="toggle-item brd-5">
<!-- 								<div class="forDelete"> -->
									<h3 class="">
										<i class="fa fa-leaf"></i><font style="font-size:x-large;">질문2</font>
										<i class="fa fa-close fa-2x delQuestion" data-idx="2" style="position:relative; top:-5px; left: 890px; background: none;"></i>
									</h3>
<!-- 								</div> -->
								<div class="content">
									<div class="questions">
										<div class="qna">
											<div class="qna-box" style="height: 50px; display: flex;">
												<label class="questionNo" style="width: 70px; font-size: larger;">질문</label>
												<input type="text" style="width: 850px;" name="sqTitle" />
											</div>
											<div class="types" style="margin-bottom: 5px;">
												<label class="questionNo" style="top: 4px; width: 70px; font-size: larger;">유형</label>
												<select name="sqType" style="width: 300px; height: 50px;" class="selects">
													<option value="">유형을 선택해주세요</option>
													<option value="">체크박스(복수선택 가능)</option>
													<option value="">라디오(단일선텍)</option>
												</select>
											</div>
											<div class="answers">
												<div class="answer">
													<span class="answerNo">①</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>
												<div class="answer">
													<span class="answerNo">②</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>
												<div class="answer">
													<span class="answerNo">③</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>
												<div class="answer">
													<span class="answerNo">④</span> 
													<input style="margin-left: 10px; height: 40px; width: 700px;" class="answerInput" type="text" />
													<i class="fa fa-close delOption" data-idx="1" style="position:relative; top: 10px; left: 10px; background: none;"></i>
												</div>

											</div>
										</div>
										<div class="answerBtn-box">
											<a href="#" id="addAnswerBtn" class="btn-st bordr rd-30">보기추가</a>
										</div>
									</div>
								</div>
							</div>

							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 아코디언 끝 -->
	<!-- 동적으로 질문 추가 끝 -->
</div>
<div class="col-md-12">
	<div class="buttonz" id="buttonz">
		<button type="button" id="addBtn">설문등록</button>
		<button type="button" id="cancelBtn">취소</button>
	</div>
</div>

<script>
	$(function() {
		
		var delQuestion = $(".delQuestion");	// 질문삭제 버튼
		var startDate;							// 설문 시작일 변수 선언
		var endDate;							// 설문 종료일 변수 선언
		
		delQuestion.on("click", function(){
			alert($(this).data("idx"));
			
		});

		$(".datepicker").datepicker(
				{
					dateFormat : 'yy-mm-dd',
					showOtherMonths : true,
					showMonthAfterYear : true,
					changeYear : true,
					changeMonth : true,
					showOn : "both",
					buttonText : "선택",
					yearSuffix : "년",
					monthNamesShort : [ '1월', '2월', '3월', '4월', '5월', '6월',
							'7월', '8월', '9월', '10월', '11월', '12월' ],
					monthNames : [ '1월', '2월', '3월', '4월', '5월', '6월', '7월',
							'8월', '9월', '10월', '11월', '12월' ],
					dayNamesMin : [ '일', '월', '화', '수', '목', '금', '토' ],
					dayNames : [ '일요일', '월요일', '화요일', '수요일', '목요일', '금요일',
							'토요일' ],
					minDate : "-5Y",
					maxDate : "+5y",
				});

		// 시작일을 선택했을 때 그 날짜를 저장한다
		$("#sfRegdate").on("change", function() {
			startDate = new Date($(this).val());
			console.log(startDate);
		});

		// 종료일을 선택했을 때 그 날짜를 시작일과 비교하여 전이라면 값 변경을 강제한다.
		$("#sfEnddate").on("change", function() {
			endDate = new Date($(this).val());
			console.log(endDate);
			if (startDate > endDate) {
				Swal.fire({
					icon : "error",
					title : "<div style='font-size:22px'>마감일은 시작일보다 빠를 수 없습니다.</div>",
					showConfirmButton : false,
					timer : 2000
				});
			};
			$(this).val("");
			return false;
		});
		$("#surveyQuestion").find("select").removeClass("nice-select");
		
		// 이미지 파일을 업로드 시 썸네일을 화면에 출력한다.
		$("#sfFile").on("change", function(event){
			var file = event.target.files[0];
			if(isimgFile(file)){ // 이미지인지를 체크하여 다른 타입은 파일을 업로드할 수 없도록 한다.
				var reader = new FileReader();
				reader.onload = function (e) {
					$("#thumimg").attr("src", e.target.result);
				}
				reader.readAsDataURL(file);
			}else {
				Swal.fire({
					icon : "error",
					title : "이미지 파일만 등록가능합니다.",
					showConfirmButton : false,
					timer : 1500
				});
			}

		});
		
		
		
	});
	
	// 파일의 타입을 리턴해준다.
	function isimgFile(file) {
		var ext = file.name.split(".").pop().toLowerCase(); // 파일명에서 확장자를 가져온다.
		return ($.inArray(ext,["jpg","jpeg","png", "gif"]) === -1) ? false : true;
	}

	// 현재 날짜를 가져오는 JavaScript 코드
	var currentDate = new Date().toISOString().slice(0, 10);

	// 입력 필드에 현재 날짜 설정
	document.getElementById("sfRegdate").setAttribute("min", currentDate);
</script>

